// https://observablehq.com/d/cff19b72da41813e@172
export default function define(runtime, observer) {
  const main = runtime.module();
  main.variable(observer()).define(["md"], function(md){return(
md`# club
The library to provide club profile and avatar data

Usage

<pre>import {club} from "cff19b72da41813e"</pre>
`
)});
  main.variable(observer("d3")).define("d3", ["require"], function(require){return(
require('d3@5')
)});
  main.variable(observer("profile")).define("profile", ["d3"], function(d3){return(
d3.json('https://spike150.mocanyc.org/api/club/profile.json')
)});
  main.variable(observer("avatar")).define("avatar", ["d3"], function(d3){return(
d3.json('https://spike150.mocanyc.org/api/club/avatar.json')
)});
  main.variable(observer("members")).define("members", ["d3"], function(d3){return(
d3.json('https://spike150.mocanyc.org/api/club/members.json')
)});
  main.variable(observer("relay_week")).define("relay_week", ["d3"], function(d3){return(
d3.json('https://spike150.mocanyc.org/api/relay/week.json')
)});
  main.variable(observer("weeks")).define("weeks", ["profile","relay_week"], function(profile,relay_week)
{
  let output = ''
  let club_weeks = {}
  for(let team in profile) {
    club_weeks[team] = []
  }
  
  for(let week in relay_week) {
    for(let team of relay_week[week].teams) {
      club_weeks[team.id].push({week: week, start: relay_week[week].start, end: relay_week[week].end})
    }
  }
  return club_weeks
}
);
  main.variable(observer("location_html")).define("location_html", ["profile"], function(profile){return(
(id) => {
  if (profile[id].loc) {
    let loc = '<ul>'
    for(let i in profile[id].loc) {
      loc += `<li>${profile[id].loc[i]}</li>`
    }
    loc += '</ul>'

    return `
<div>
Meetup locations: ${loc}
</div> 
` }
  else {
    return ''
  }
}
)});
  main.variable(observer("strava_svg")).define("strava_svg", function(){return(
`
<svg xmlns="http://www.w3.org/2000/svg" version="1.2" baseProfile="tiny" x="0px" y="0px" width="200px" height="50px" viewBox="0 0 200 30.327148" xml:space="preserve"><path fill="#FC4C02" d="M19.161621 40.397949c-3.805664 0-7.35791-0.529785-10.649902-1.575684C5.219238 37.769043 2.383301 36.194824 0 34.101074l6.67041-7.949707c2.027344 1.563477 4.166016 2.685059 6.403809 3.359375 2.241699 0.676758 4.467773 1.015137 6.673828 1.015137 1.141113 0 1.956055-0.143555 2.456055-0.424805 0.501953-0.286621 0.746094-0.678711 0.746094-1.174316v-0.106445c0-0.538086-0.368652-0.98877-1.094238-1.337402 -0.725586-0.356445-2.092773-0.728027-4.084961-1.118164 -2.098145-0.429688-4.101562-0.930664-6.002441-1.498535 -1.904785-0.564453-3.575684-1.297363-5.016113-2.187988 -1.442871-0.886719-2.589355-2.011719-3.445312-3.362305 -0.854004-1.354004-1.28125-3.009766-1.28125-4.964844v-0.106934c0-1.780762 0.346191-3.437012 1.042969-4.965332C3.756836 7.749512 4.772949 6.412109 6.10791 5.276855c1.335449-1.139648 2.993164-2.027344 4.969727-2.671875 1.967773-0.639648 4.238281-0.959473 6.804199-0.959473 3.625 0 6.800781 0.428711 9.523926 1.284668 2.723145 0.848145 5.166992 2.130859 7.34082 3.837891l-6.083496 8.435059c-1.779785-1.28418-3.658203-2.217285-5.631836-2.806152 -1.97998-0.588379-3.831543-0.882812-5.57959-0.882812 -0.922852 0-1.607422 0.142578-2.051758 0.427734 -0.452637 0.284668-0.667969 0.660156-0.667969 1.121094v0.105469c0 0.501953 0.334473 0.929199 1.013184 1.286133 0.679199 0.354004 1.994141 0.729004 3.948242 1.120117 2.385254 0.424805 4.554199 0.941895 6.516602 1.543457 1.953125 0.61084 3.639648 1.381348 5.041504 2.32666 1.405273 0.942383 2.494141 2.067383 3.256836 3.388184 0.763672 1.316895 1.147461 2.92041 1.147461 4.802734v0.109863c0 1.954102-0.390137 3.719727-1.17627 5.282715 -0.780762 1.567383-1.88623 2.890137-3.309082 3.978516 -1.424316 1.08252-3.151855 1.917969-5.179199 2.506348C23.966309 40.103027 21.68457 40.397949 19.161621 40.397949L19.161621 40.397949z"/><polygon fill="#FC4C02" points="45.95459,12.902832 34.958984,12.902832 34.958984,2.342285 69.446777,2.342285 69.446777,12.902832 58.447754,12.902832 58.447754,39.69873 45.95459,39.69873 45.95459,12.902832 "/><path fill="#FC4C02" d="M89.086914 20.115234c1.495605 0 2.671875-0.321289 3.521484-0.960449 0.854004-0.641602 1.283203-1.534668 1.283203-2.672852v-0.10791c0-1.207031-0.429199-2.108398-1.283203-2.689941 -0.849609-0.588379-2.011719-0.879883-3.466309-0.879883h-5.447754v7.311035H89.086914L89.086914 20.115234zM71.203125 2.342285h18.258301c3.344238 0 6.092773 0.383789 8.244141 1.148438 2.15625 0.763672 3.886719 1.806641 5.20459 3.123535 1.141602 1.135254 1.994629 2.418945 2.566406 3.837402 0.566406 1.423828 0.853516 3.102051 0.853516 5.01416v0.11377c0 2.737305-0.658691 5.050781-1.979492 6.93457 -1.312988 1.885254-3.109375 3.384766-5.390625 4.48291l8.698242 12.70166H93.40918l-7.047363-10.67334h-0.101562 -2.565918v10.67334H71.203125V2.342285L71.203125 2.342285z"/><polygon fill="#FC4C02" points="179.889648,23.627441 188.032227,39.69873 200,39.69873 179.889648,0 159.781738,39.69873 171.753418,39.69873 179.889648,23.627441 "/><polygon fill="#FC4C02" points="123.918457,23.627441 132.058105,39.69873 144.028809,39.69873 123.918457,0 103.818848,39.69873 115.78418,39.69873 123.918457,23.627441 "/><polygon fill="#FC4C02" points="151.912598,18.412598 143.76709,2.342285 131.796387,2.342285 151.912598,42.041016 172.01416,2.342285 160.051758,2.342285 151.912598,18.412598 "/><path fill="#FFFFFF" d="M19.161621 84.541016c-3.805664 0-7.35791-0.529785-10.649902-1.575684C5.219238 81.912598 2.383301 80.337891 0 78.244141l6.67041-7.949707c2.027344 1.563477 4.166016 2.685059 6.403809 3.359375 2.241699 0.676758 4.467773 1.015137 6.673828 1.015137 1.141113 0 1.956055-0.143555 2.456055-0.424805 0.501953-0.286133 0.746094-0.678223 0.746094-1.174316v-0.106445c0-0.538086-0.368652-0.98877-1.094238-1.337402 -0.725586-0.356445-2.092773-0.728027-4.084961-1.117676 -2.098145-0.430176-4.101562-0.931152-6.002441-1.498535 -1.904785-0.564453-3.575684-1.297363-5.016113-2.188477C5.30957 65.93457 4.163086 64.80957 3.307129 63.458984c-0.854004-1.354004-1.28125-3.009766-1.28125-4.964844v-0.106934c0-1.780762 0.346191-3.437012 1.042969-4.965332 0.687988-1.529297 1.704102-2.866699 3.039062-4.001953 1.335449-1.13916 2.993164-2.027344 4.969727-2.671875 1.967773-0.63916 4.238281-0.959473 6.804199-0.959473 3.625 0 6.800781 0.428711 9.523926 1.285156 2.723145 0.847656 5.166992 2.130371 7.34082 3.837402l-6.083496 8.435059c-1.779785-1.28418-3.658203-2.217285-5.631836-2.806152 -1.97998-0.588379-3.831543-0.882812-5.57959-0.882812 -0.922852 0-1.607422 0.142578-2.051758 0.428223 -0.452637 0.28418-0.667969 0.659668-0.667969 1.120605v0.105957c0 0.501465 0.334473 0.928711 1.013184 1.285645 0.679199 0.354492 1.994141 0.729004 3.948242 1.120117 2.385254 0.424805 4.554199 0.941895 6.516602 1.543457 1.953125 0.61084 3.639648 1.381836 5.041504 2.327148 1.405273 0.941895 2.494141 2.066895 3.256836 3.387695 0.763672 1.316895 1.147461 2.92041 1.147461 4.802734v0.109863c0 1.954102-0.390137 3.719727-1.17627 5.282715 -0.780762 1.567383-1.88623 2.890625-3.309082 3.978516 -1.424316 1.08252-3.151855 1.917969-5.179199 2.506348C23.966309 84.246582 21.68457 84.541016 19.161621 84.541016L19.161621 84.541016z"/><polygon fill="#FFFFFF" points="45.95459,57.045898 34.958984,57.045898 34.958984,46.485352 69.446777,46.485352 69.446777,57.045898 58.447754,57.045898 58.447754,83.841797 45.95459,83.841797 45.95459,57.045898 "/><path fill="#FFFFFF" d="M89.086914 64.258301c1.495605 0 2.671875-0.321289 3.521484-0.960449 0.854004-0.641602 1.283203-1.534668 1.283203-2.672852v-0.10791c0-1.207031-0.429199-2.10791-1.283203-2.689941 -0.849609-0.588379-2.011719-0.879883-3.466309-0.879883h-5.447754v7.311035H89.086914L89.086914 64.258301zM71.203125 46.485352h18.258301c3.344238 0 6.092773 0.383789 8.244141 1.148438 2.15625 0.763672 3.886719 1.806641 5.20459 3.123535 1.141602 1.135254 1.994629 2.418945 2.566406 3.837402 0.566406 1.423828 0.853516 3.102051 0.853516 5.01416v0.11377c0 2.737305-0.658691 5.050781-1.979492 6.93457 -1.312988 1.885254-3.109375 3.384766-5.390625 4.48291l8.698242 12.70166H93.40918l-7.047363-10.67334h-0.101562 -2.565918v10.67334H71.203125V46.485352L71.203125 46.485352z"/><polygon fill="#FFFFFF" points="179.889648,67.770508 188.032227,83.841797 200,83.841797 179.889648,44.143066 159.781738,83.841797 171.753418,83.841797 179.889648,67.770508 "/><polygon fill="#FFFFFF" points="123.918457,67.770508 132.058105,83.841797 144.028809,83.841797 123.918457,44.143066 103.818848,83.841797 115.78418,83.841797 123.918457,67.770508 "/><polygon fill="#FFFFFF" points="151.912598,62.555664 143.76709,46.485352 131.796387,46.485352 151.912598,86.184082 172.01416,46.485352 160.051758,46.485352 151.912598,62.555664 "/><path fill="#B0B0B0" d="M19.161621 128.684082c-3.805664 0-7.35791-0.529785-10.649902-1.575684C5.219238 126.055664 2.383301 124.480957 0 122.387207l6.67041-7.949219c2.027344 1.562988 4.166016 2.685059 6.403809 3.359375 2.241699 0.67627 4.467773 1.015137 6.673828 1.015137 1.141113 0 1.956055-0.144043 2.456055-0.425293 0.501953-0.286133 0.746094-0.678223 0.746094-1.174316v-0.106445c0-0.538086-0.368652-0.988281-1.094238-1.337402 -0.725586-0.355957-2.092773-0.727539-4.084961-1.117676 -2.098145-0.430176-4.101562-0.931152-6.002441-1.498535 -1.904785-0.564453-3.575684-1.297363-5.016113-2.188477 -1.442871-0.886719-2.589355-2.011719-3.445312-3.362305 -0.854004-1.354004-1.28125-3.009277-1.28125-4.964844v-0.106445c0-1.780762 0.346191-3.4375 1.042969-4.96582 0.687988-1.529297 1.704102-2.866699 3.039062-4.001953 1.335449-1.13916 2.993164-2.027344 4.969727-2.671875 1.967773-0.63916 4.238281-0.959473 6.804199-0.959473 3.625 0 6.800781 0.429199 9.523926 1.285156 2.723145 0.847656 5.166992 2.130859 7.34082 3.837402l-6.083496 8.435059c-1.779785-1.28418-3.658203-2.216797-5.631836-2.806152 -1.97998-0.588379-3.831543-0.882812-5.57959-0.882812 -0.922852 0-1.607422 0.142578-2.051758 0.428223 -0.452637 0.28418-0.667969 0.659668-0.667969 1.120605v0.105957c0 0.501953 0.334473 0.928711 1.013184 1.286133 0.679199 0.354004 1.994141 0.728516 3.948242 1.119629 2.385254 0.424805 4.554199 0.942383 6.516602 1.543457 1.953125 0.61084 3.639648 1.381836 5.041504 2.327148 1.405273 0.941895 2.494141 2.066895 3.256836 3.388184 0.763672 1.316895 1.147461 2.919922 1.147461 4.802246v0.109863c0 1.954102-0.390137 3.719727-1.17627 5.282715 -0.780762 1.567383-1.88623 2.890625-3.309082 3.978516 -1.424316 1.083008-3.151855 1.918457-5.179199 2.506348C23.966309 128.389648 21.68457 128.684082 19.161621 128.684082L19.161621 128.684082z"/><polygon fill="#B0B0B0" points="45.95459,101.188965 34.958984,101.188965 34.958984,90.628418 69.446777,90.628418 69.446777,101.188965 58.447754,101.188965 58.447754,127.985352 45.95459,127.985352 45.95459,101.188965 "/><path fill="#B0B0B0" d="M89.086914 108.401367c1.495605 0 2.671875-0.321289 3.521484-0.960449 0.854004-0.641602 1.283203-1.534668 1.283203-2.672852v-0.10791c0-1.207031-0.429199-2.10791-1.283203-2.689941 -0.849609-0.588379-2.011719-0.879883-3.466309-0.879883h-5.447754v7.311035H89.086914L89.086914 108.401367zM71.203125 90.628418h18.258301c3.344238 0 6.092773 0.383789 8.244141 1.148438 2.15625 0.763672 3.886719 1.806641 5.20459 3.123535 1.141602 1.135254 1.994629 2.418945 2.566406 3.837891 0.566406 1.42334 0.853516 3.101562 0.853516 5.013672v0.11377c0 2.737793-0.658691 5.05127-1.979492 6.93457 -1.312988 1.885254-3.109375 3.384766-5.390625 4.483398l8.698242 12.70166H93.40918l-7.047363-10.673828h-0.101562 -2.565918v10.673828H71.203125V90.628418L71.203125 90.628418z"/><polygon fill="#B0B0B0" points="179.889648,111.914062 188.032227,127.985352 200,127.985352 179.889648,88.286133 159.781738,127.985352 171.753418,127.985352 179.889648,111.914062 "/><polygon fill="#B0B0B0" points="123.918457,111.914062 132.058105,127.985352 144.028809,127.985352 123.918457,88.286133 103.818848,127.985352 115.78418,127.985352 123.918457,111.914062 "/><polygon fill="#B0B0B0" points="151.912598,106.69873 143.76709,90.628418 131.796387,90.628418 151.912598,130.327148 172.01416,90.628418 160.051758,90.628418 151.912598,106.69873 "/></svg>
`
)});
  main.variable(observer("list_html")).define("list_html", ["avatar","profile","members","location_html","relay_weeks"], function(avatar,profile,members,location_html,relay_weeks){return(
(id) => {
  const base = 'https://spike150.mocanyc.org/spike-relay/club/club.html'
  return `
<div style="margin-top: 1em; background: #FFF7ED; padding: 1em; border-radius: 5px;">
  <img src="${avatar[id].src}" style="width: 64px; heigh:64px; border-radius: 64px;"/>
  <h3>
    <a href="${base}#${id}">
      ${profile[id].en ? profile[id].en : '' } 
      ${profile[id].cn ? `| ${profile[id].cn} `: '' }
    </a>
  </h3>
  <div>
    Club size: ${profile[id].size} 
  </div>
  <div>
    Strava members: ${members[id]} 
  </div>
  <div>
    ${location_html(id)}
  </div>
${relay_weeks(id)}
</div>
`  
}
)});
  main.variable(observer("logo_html")).define("logo_html", ["profile","avatar"], function(profile,avatar){return(
(id) => {
  const base = 'https://spike150.mocanyc.org/spike-relay/club/club.html'
  const title = `${profile[id].en ? profile[id].en : ''}  ${profile[id].cn ? `| ${profile[id].cn} `: '' }`
  return `
<a href="${base}#${id}"
title="${title}">
<img src="${avatar[id].src}" style="width: 64px; heigh:64px; border-radius: 64px;"
alt="${title}"
/>
</a>
`  
}
)});
  main.variable(observer("relay_weeks")).define("relay_weeks", ["weeks"], function(weeks){return(
(id) => {
  const by_week = (x, y) => {
    if(parseInt(x.week) > parseInt(y.week)) return 1;
    if(parseInt(x.week) < parseInt(y.week)) return -1;
    return 0
  }
  
  let week_list = '<div>Relay Weeks: <ul>'
  for( let week of weeks[id].sort(by_week)) {
    week_list += `<li>
Week ${parseInt(week.week)}
(${week.start.replace('2019-', '').replace('-', '/')} to ${week.end.replace('2019-', '').replace('-', '/')})
</li>`
  }
  week_list += '</ul></div>'
  return week_list
}
)});
  main.variable(observer("detail_html")).define("detail_html", ["profile","avatar","members","location_html","relay_weeks"], function(profile,avatar,members,location_html,relay_weeks){return(
(id) => {
  let club = profile[id]
  const base = 'https://spike150.mocanyc.org/spike-relay/club/index.html'
  return `
<div style="margin-top: 1em; background: #FFF7ED; padding: 2em; border-radius: 5px;">
<div style="text-align: right;"><a href="${base}">MOCA Spike 150 Relay Clubs</a></div>
<p>
<img src="${avatar[id].src}" style="width:128px;height:128px;border-radius:128px;"/>
<h1>
${club.en ? club.en: '' }
${club.cn ? club.cn: '' }
</h1>
  <div>
    Club size: ${profile[id].size} 
  </div>
  <div>
    Strava members: ${members[id]} 
  </div>
  <div>
    ${location_html(id)}
  </div>
${relay_weeks(id)}
<p>
${club.desc ? club.desc: ''}
</p>
<p>
${club['desc-cn'] ? club['desc-cn']: ''}
</p>
<h6>Strava:</h6>
<a href="https://www.strava.com/clubs/${id}">
https://www.strava.com/clubs/${id}
</a>
${club.url? '<h6>Website:</h6> <a href="' + club.url + '"/>' + club.url + '</a>': ''}
`
}
)});
  main.variable(observer("club")).define("club", ["profile","avatar","members","list_html","detail_html","logo_html","weeks"], function(profile,avatar,members,list_html,detail_html,logo_html,weeks)
{ 
  let club = {}
  club.profile = profile
  club.avatar = avatar
  club.members = members
  club.list_html = list_html
  club.detail_html = detail_html
  club.logo_html = logo_html
  club.weeks = weeks
  return club
}
);
  main.variable(observer()).define(["html","club"], function(html,club){return(
html`${club.detail_html(327007)}`
)});
  main.variable(observer()).define(["html","club"], function(html,club){return(
html`${club.list_html(327007)}`
)});
  main.variable(observer()).define(["html","club"], function(html,club){return(
html`${club.logo_html(327007)}`
)});
  return main;
}
